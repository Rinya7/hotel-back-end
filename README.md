# Hotel Backend API

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥–æ—Ç–µ–ª—è–º–∏ –∑ —Ä–æ–ª—è–º–∏ superadmin, admin —Ç–∞ editor.

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç (–¥–ª—è —á–∞–π–Ω–∏–∫—ñ–≤)

### 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
npm install
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

#### –í–∞—Ä—ñ–∞–Ω—Ç A: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ PostgreSQL –≤ Docker
docker run --name hotel-db \
  -e POSTGRES_PASSWORD=mysecretpassword \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_DB=hotel \
  -p 5432:5432 \
  -d postgres

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω–∏–π
docker ps
```

#### –í–∞—Ä—ñ–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω–∏–π PostgreSQL

–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ —ñ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–∑—É `hotel`.

### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=mysecretpassword
DB_NAME=hotel

# JWT
JWT_SECRET=your-super-secret-key-here

# –°—É–ø–µ—Ä-–∞–¥–º—ñ–Ω
SUPERADMIN_USERNAME=superadmin
SUPERADMIN_PASSWORD=your-superadmin-password
```

### 4. –ü–µ—Ä—à–∏–π –∑–∞–ø—É—Å–∫ (—Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑)

```bash
# –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó (—Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—ñ)
npm run db:migrate

# –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å—É–ø–µ—Ä-–∞–¥–º—ñ–Ω–∞
npm run seed:superadmin
```

### 5. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –†–µ–∂–∏–º —Ä–æ–∑—Ä–æ–±–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)
npm run dev

# –ê–±–æ –∑–≤–∏—á–∞–π–Ω–∏–π –∑–∞–ø—É—Å–∫
npm start
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ http://localhost:3000

### 6. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

1. **Swagger UI:** http://localhost:3000/docs
2. **–õ–æ–≥—ñ–Ω —Å—É–ø–µ—Ä-–∞–¥–º—ñ–Ω–∞:**
   ```bash
   curl -X POST http://localhost:3000/auth/login \
     -H "Content-Type: application/json" \
     -d '{"username": "superadmin", "password": "your-superadmin-password"}'
   ```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
src/
‚îú‚îÄ‚îÄ app.ts                 # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª Express
‚îú‚îÄ‚îÄ index.ts              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É
‚îú‚îÄ‚îÄ config/               # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îÇ   ‚îú‚îÄ‚îÄ data-source.ts    # TypeORM –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îÇ   ‚îú‚îÄ‚îÄ swagger.ts        # Swagger UI
‚îÇ   ‚îî‚îÄ‚îÄ openapi-validator.ts # –í–∞–ª—ñ–¥–∞—Ü—ñ—è API
‚îú‚îÄ‚îÄ controllers/          # –û–±—Ä–æ–±–Ω–∏–∫–∏ –∑–∞–ø–∏—Ç—ñ–≤
‚îú‚îÄ‚îÄ entities/            # –ú–æ–¥–µ–ª—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ middlewares/         # –ü—Ä–æ–º—ñ–∂–Ω–µ –ü–ó (auth, errors)
‚îú‚îÄ‚îÄ routes/              # –ú–∞—Ä—à—Ä—É—Ç–∏ API
‚îú‚îÄ‚îÄ services/            # –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
‚îú‚îÄ‚îÄ migrations/          # –ú—ñ–≥—Ä–∞—Ü—ñ—ó –ë–î
‚îú‚îÄ‚îÄ seeds/              # –ü–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ
‚îî‚îÄ‚îÄ utils/              # –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
```

## üõ† –ö–æ–º–∞–Ω–¥–∏ —Ä–æ–∑—Ä–æ–±–∫–∏

### –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö

```bash
# –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó
npm run db:migrate

# –í—ñ–¥–∫–æ—Ç–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é –º—ñ–≥—Ä–∞—Ü—ñ—é
npm run db:revert

# –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –Ω–æ–≤—É –º—ñ–≥—Ä–∞—Ü—ñ—é (–∫–æ–ª–∏ –∑–º—ñ–Ω–∏–ª–∏ entities)
npm run db:gen:init

# –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å—É–ø–µ—Ä-–∞–¥–º—ñ–Ω–∞
npm run seed:superadmin
```

### OpenAPI

```bash
# –ó—ñ–±—Ä–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é
npm run openapi:bundle

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å
npm run openapi:lint
```

## üîê –†–æ–ª—ñ —Ç–∞ –ø—Ä–∞–≤–∞

### Superadmin
- –°—Ç–≤–æ—Ä—é—î/–±–ª–æ–∫—É—î –∞–¥–º—ñ–Ω—ñ–≤
- –ë–∞—á–∏—Ç—å –≤—Å—ñ –∫—ñ–º–Ω–∞—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—ñ
- –ö–µ—Ä—É—î –≤—Å—ñ–º–∞ –≥–æ—Ç–µ–ª—è–º–∏

### Admin
- –ö–µ—Ä—É—î —Å–≤–æ—ó–º –≥–æ—Ç–µ–ª–µ–º
- –°—Ç–≤–æ—Ä—é—î/–∫–µ—Ä—É—î —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏
- CRUD –∫—ñ–º–Ω–∞—Ç
- –ö–µ—Ä—É—î –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è–º–∏

### Editor
- –ü—Ä–∞—Ü—é—î –∑—ñ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∫—ñ–º–Ω–∞—Ç
- –ö–µ—Ä—É—î –≥–æ—Å—Ç—è–º–∏
- –ù–ï –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∞–±–æ –∫—ñ–º–Ω–∞—Ç–∏

## üìö API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
- `POST /auth/login` ‚Äî –ª–æ–≥—ñ–Ω
- `POST /auth/create-admin` ‚Äî —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∞–¥–º—ñ–Ω–∞ (superadmin)
- `PUT /auth/admin/{username}` ‚Äî —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å –∞–¥–º—ñ–Ω–∞ (superadmin)
- `POST /auth/create-editor` ‚Äî —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ (admin)
- `GET /auth/users` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- `PUT /auth/block/{username}` ‚Äî –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏
- `PUT /auth/unblock/{username}` ‚Äî —Ä–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏
- `DELETE /auth/delete/{username}` ‚Äî –≤–∏–¥–∞–ª–∏—Ç–∏

### –ö—ñ–º–Ω–∞—Ç–∏
- `GET /rooms` ‚Äî —Å–ø–∏—Å–æ–∫ –∫—ñ–º–Ω–∞—Ç –≥–æ—Ç–µ–ª—é
- `GET /rooms/all` ‚Äî –≤—Å—ñ –∫—ñ–º–Ω–∞—Ç–∏ (superadmin)
- `GET /rooms/status/{status}` ‚Äî –∫—ñ–º–Ω–∞—Ç–∏ –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º
- `POST /rooms` ‚Äî —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫—ñ–º–Ω–∞—Ç—É
- `PUT /rooms/number/{roomNumber}` ‚Äî —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏
- `DELETE /rooms/number/{roomNumber}` ‚Äî –≤–∏–¥–∞–ª–∏—Ç–∏
- `PUT /rooms/number/{roomNumber}/status` ‚Äî –∑–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
- `GET /rooms/number/{roomNumber}/availability` ‚Äî –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –æ–¥–Ω—ñ—î—ó –∫—ñ–º–Ω–∞—Ç–∏

### –ú–∞—Å–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
- `PUT /rooms/policy-hours/bulk` ‚Äî –º–∞—Å–æ–≤–µ –∑–∞–¥–∞–Ω–Ω—è —á–∞—Å—É –∑–∞—Å–µ–ª–µ–Ω–Ω—è/–≤–∏—ó–∑–¥—É
- `PUT /rooms/wifi/bulk` ‚Äî –º–∞—Å–æ–≤–µ –∑–∞–¥–∞–Ω–Ω—è WiFi –¥–∞–Ω–∏—Ö

### –ü—Ä–æ–∂–∏–≤–∞–Ω–Ω—è
- `GET /rooms/number/{roomNumber}/stays` ‚Äî —ñ—Å—Ç–æ—Ä—ñ—è –∫—ñ–º–Ω–∞—Ç–∏
- `GET /rooms/stays/current` ‚Äî –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è
- `POST /rooms/number/{roomNumber}/stays` ‚Äî —Å—Ç–≤–æ—Ä–∏—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
- `PUT /rooms/number/{roomNumber}/stays` ‚Äî —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è
- `PUT /rooms/number/{roomNumber}/stays/close` ‚Äî –∑–∞–∫—Ä–∏—Ç–∏
- `POST /stays/{id}/check-in` ‚Äî –∑–∞—Å–µ–ª–∏—Ç–∏
- `POST /stays/{id}/check-out` ‚Äî –≤–∏—Å–µ–ª–∏—Ç–∏
- `POST /stays/{id}/cancel` ‚Äî —Å–∫–∞—Å—É–≤–∞—Ç–∏
- `GET /stays/status/{status}` ‚Äî –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /rooms/stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ñ–º–Ω–∞—Ç
- `GET /rooms/availability` ‚Äî –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –≤—Å—ñ—Ö –∫—ñ–º–Ω–∞—Ç
- `GET /stays/today/arrivals` ‚Äî —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—ñ –∑–∞—ó–∑–¥–∏
- `GET /stays/today/departures` ‚Äî —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—ñ –≤–∏—ó–∑–¥–∏

## üêõ –ß–∞—Å—Ç—ñ –ø—Ä–æ–±–ª–µ–º–∏

### "password authentication failed"
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `.env` —Ñ–∞–π–ª
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω–∏–π
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–∞—Ä–æ–ª—å –≤ Docker –∫–æ–º–∞–Ω–¥—ñ

### "relation does not exist"
- –ù–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó: `npm run db:migrate`
- –ê–±–æ –ø–æ–≤–Ω–∏–π —Ä–µ—Å–µ—Ç: `npm run db:revert && npm run db:migrate`

### "No migrations are pending"
- –°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ—é: `npm run db:gen:init`
- –ü–æ—Ç—ñ–º –∑–∞—Å—Ç–æ—Å—É–π—Ç–µ: `npm run db:migrate`

### –ü–æ—Ä—Ç 5432 –∑–∞–π–Ω—è—Ç–∏–π
- –ó—É–ø–∏–Ω—ñ—Ç—å —ñ–Ω—à–∏–π PostgreSQL: `docker stop hotel-db`
- –ê–±–æ –∑–º—ñ–Ω—ñ—Ç—å –ø–æ—Ä—Ç –≤ Docker –∫–æ–º–∞–Ω–¥—ñ: `-p 5433:5432`

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏

### DBeaver (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ DBeaver
2. New Database Connection ‚Üí PostgreSQL
3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:
   - Host: `localhost`
   - Port: `5432`
   - Database: `hotel`
   - Username: `postgres`
   - Password: `mysecretpassword`

### VS Code
–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
- TypeScript Importer
- REST Client
- PostgreSQL

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- **Swagger UI:** http://localhost:3000/docs
- **API JSON:** http://localhost:3000/docs.json
- **OpenAPI —Å—Ö–µ–º–∞:** `openapi/openapi.yaml`

## üöÄ Production

1. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
2. `npm run db:migrate`
3. `npm run seed:superadmin`
4. `npm start`

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î
3. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤—Å—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `.env` —Ñ–∞–π–ª