openapi: 3.0.3
info:
  title: Hotel Backend API
  version: 1.0.0
  description: |
    Модульний OpenAPI. Всі components тут. Кожен шлях підключено через $ref до файла у /openapi/paths/*.yaml, де PathItem зберігається під ключами-ідентифікаторами.
servers:
  - url: 'http://localhost:3000'
    description: Local dev
tags:
  - name: Auth
    description: Логін та керування користувачами
  - name: Rooms
    description: 'CRUD, статуси'
  - name: Policy Hours
    description: Масові години заселення/виїзду для кімнат
  - name: Wi-Fi Management
    description: Масове керування Wi-Fi даними для кімнат
  - name: Availability & Stats
    description: 'Доступність, статистика, активні проживання'
  - name: Stays
    description: Створення/редагування/закриття/історія проживань
  - name: Stay Ops
    description: Ручні check-in/out/cancel
  - name: Stay Queries
    description: 'Добірки для дашборда (за статусом, заїзди/виїзди сьогодні)'
  - name: Audit
    description: Універсальні audit logs для Room та Stay
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    ErrorResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
    SimpleMessage:
      type: object
      properties:
        message:
          type: string
    Role:
      type: string
      enum:
        - superadmin
        - admin
        - editor
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
        password:
          type: string
    LoginPayload:
      type: object
      required:
        - token
        - username
        - role
        - adminId
      properties:
        token:
          type: string
          description: JWT (48h)
        username:
          type: string
        role:
          $ref: '#/components/schemas/Role'
        adminId:
          type: integer
          description: |
            Власник готелю: для admin — його id; для editor — id owner admin.
        hotelName:
          type: string
          nullable: true
        policy:
          type: object
          nullable: true
          properties:
            checkInHour:
              type: integer
              minimum: 0
              maximum: 23
            checkOutHour:
              type: integer
              minimum: 0
              maximum: 23
    LoginResponse:
      type: object
      properties:
        payload:
          $ref: '#/components/schemas/LoginPayload'
    CreateAdminRequest:
      type: object
      required:
        - username
        - password
        - confirmPassword
        - hotel_name
        - street
      properties:
        username:
          type: string
        password:
          type: string
        confirmPassword:
          type: string
        hotel_name:
          type: string
        street:
          type: string
          description: Улица (обязательное поле)
        buildingNumber:
          type: string
          nullable: true
        apartmentNumber:
          type: string
          nullable: true
        country:
          type: string
          nullable: true
          description: 'Код страны (например, IT, UA)'
        province:
          type: string
          nullable: true
          description: Провинция/Регион
        postalCode:
          type: string
          nullable: true
        latitude:
          type: string
          nullable: true
          description: Широта (автоматически получается если не указана)
        longitude:
          type: string
          nullable: true
          description: Долгота (автоматически получается если не указана)
        full_name:
          type: string
          nullable: true
        phoneCountryCode:
          type: string
          nullable: true
          description: 'Код страны телефона (например, +39, +380)'
        phoneNumber:
          type: string
          nullable: true
          description: Номер телефона без кода страны
        phone:
          type: string
          nullable: true
          description: Старое поле для обратной совместимости
        email:
          type: string
          nullable: true
        checkInHour:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
        checkOutHour:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
        defaultWifiName:
          type: string
          nullable: true
        defaultWifiPassword:
          type: string
          nullable: true
    CreateAdminResponse:
      type: object
      required:
        - message
        - adminId
        - policy
      properties:
        message:
          type: string
        adminId:
          type: integer
        policy:
          type: object
          properties:
            checkInHour:
              type: integer
            checkOutHour:
              type: integer
    UpdateHotelAdminRequest:
      type: object
      description: Будь-яке з полів; не всі обов'язкові
      properties:
        hotel_name:
          type: string
        street:
          type: string
          nullable: true
        buildingNumber:
          type: string
          nullable: true
        apartmentNumber:
          type: string
          nullable: true
        country:
          type: string
          nullable: true
        province:
          type: string
          nullable: true
        postalCode:
          type: string
          nullable: true
        latitude:
          type: string
          nullable: true
        longitude:
          type: string
          nullable: true
        full_name:
          type: string
          nullable: true
        phoneCountryCode:
          type: string
          nullable: true
        phoneNumber:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
          description: Старое поле для обратной совместимости
        email:
          type: string
          nullable: true
        logo_url:
          type: string
          nullable: true
        checkInHour:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
        checkOutHour:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
        defaultWifiName:
          type: string
          nullable: true
        defaultWifiPassword:
          type: string
          nullable: true
    UpdateHotelAdminResponse:
      type: object
      properties:
        message:
          type: string
        admin:
          type: object
          properties:
            id:
              type: integer
            username:
              type: string
            hotel_name:
              type: string
              nullable: true
            street:
              type: string
              nullable: true
            buildingNumber:
              type: string
              nullable: true
            apartmentNumber:
              type: string
              nullable: true
            country:
              type: string
              nullable: true
            province:
              type: string
              nullable: true
            postalCode:
              type: string
              nullable: true
            latitude:
              type: string
              nullable: true
            longitude:
              type: string
              nullable: true
            full_name:
              type: string
              nullable: true
            phoneCountryCode:
              type: string
              nullable: true
            phoneNumber:
              type: string
              nullable: true
            phone:
              type: string
              nullable: true
              description: 'Для обратной совместимости, формируется из phoneCountryCode и phoneNumber'
            email:
              type: string
              nullable: true
            logo_url:
              type: string
              nullable: true
            checkInHour:
              type: integer
              nullable: true
            checkOutHour:
              type: integer
              nullable: true
            defaultWifiName:
              type: string
              nullable: true
            defaultWifiPassword:
              type: string
              nullable: true
            updatedAt:
              type: string
              format: date-time
    CreateEditorRequest:
      type: object
      required:
        - username
        - password
        - confirmPassword
      properties:
        username:
          type: string
        password:
          type: string
        confirmPassword:
          type: string
        full_name:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        email:
          type: string
          nullable: true
    CreateEditorResponse:
      type: object
      properties:
        message:
          type: string
        token:
          type: string
    PublicAdminUser:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        role:
          $ref: '#/components/schemas/Role'
        hotel_name:
          type: string
          nullable: true
        address:
          type: string
          nullable: true
        full_name:
          type: string
          nullable: true
        logo_url:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        email:
          type: string
          nullable: true
        isBlocked:
          type: boolean
        checkInHour:
          type: integer
          nullable: true
        checkOutHour:
          type: integer
          nullable: true
        defaultWifiName:
          type: string
          nullable: true
        defaultWifiPassword:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        editorsCount:
          type: integer
        editors:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              username:
                type: string
              role:
                $ref: '#/components/schemas/Role'
              full_name:
                type: string
                nullable: true
              phone:
                type: string
                nullable: true
              email:
                type: string
                nullable: true
              isBlocked:
                type: boolean
              createdAt:
                type: string
                format: date-time
              updatedAt:
                type: string
                format: date-time
    PublicEditorUser:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        role:
          $ref: '#/components/schemas/Role'
        full_name:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        email:
          type: string
          nullable: true
        isBlocked:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    RoomStatus:
      type: string
      enum:
        - free
        - booked
        - occupied
        - cleaning
    Room:
      type: object
      properties:
        id:
          type: integer
        roomNumber:
          type: string
        floor:
          type: integer
        capacity:
          type: integer
        status:
          $ref: '#/components/schemas/RoomStatus'
        checkInHour:
          type: integer
          nullable: true
        checkOutHour:
          type: integer
          nullable: true
        wifiName:
          type: string
          nullable: true
        wifiPassword:
          type: string
          nullable: true
        qrBarUrl:
          type: string
          nullable: true
        mapPosition:
          type: string
          nullable: true
        lastCleanedAt:
          type: string
          format: date-time
          nullable: true
        lastCleanedBy:
          type: string
          nullable: true
    CreateRoomRequest:
      type: object
      required:
        - roomNumber
        - floor
        - capacity
      properties:
        roomNumber:
          type: string
        floor:
          type: integer
          minimum: 0
        capacity:
          type: integer
          minimum: 0
        checkInHour:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
        checkOutHour:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
        wifiName:
          type: string
          nullable: true
        wifiPassword:
          type: string
          nullable: true
        qrBarUrl:
          type: string
          nullable: true
        mapPosition:
          type: string
          nullable: true
    UpdateRoomRequest:
      type: object
      properties:
        roomNumber:
          type: string
        floor:
          type: integer
          minimum: 0
        capacity:
          type: integer
          minimum: 0
        checkInHour:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
        checkOutHour:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
        wifiName:
          type: string
          nullable: true
        wifiPassword:
          type: string
          nullable: true
        qrBarUrl:
          type: string
          nullable: true
        mapPosition:
          type: string
          nullable: true
    RoomResponse:
      type: object
      properties:
        message:
          type: string
        room:
          $ref: '#/components/schemas/Room'
    RoomStatusUpdateRequest:
      type: object
      required:
        - status
      properties:
        status:
          $ref: '#/components/schemas/RoomStatus'
    RoomsStats:
      type: object
      properties:
        free:
          type: integer
        booked:
          type: integer
        occupied:
          type: integer
        cleaning:
          type: integer
    AvailabilityConflict:
      type: object
      properties:
        id:
          type: integer
        status:
          type: string
          enum:
            - booked
            - occupied
            - completed
            - cancelled
        mainGuestName:
          type: string
        checkIn:
          type: string
          format: date
        checkOut:
          type: string
          format: date
        balance:
          oneOf:
            - type: number
            - type: string
    AvailabilityItem:
      type: object
      properties:
        roomId:
          type: integer
        roomNumber:
          type: string
        floor:
          type: integer
        capacity:
          type: integer
        currentStatus:
          type: string
          enum:
            - free
            - booked
            - occupied
        available:
          type: boolean
        conflictsCount:
          type: integer
        conflicts:
          type: array
          items:
            $ref: '#/components/schemas/AvailabilityConflict'
    StayStatus:
      type: string
      enum:
        - booked
        - occupied
        - completed
        - cancelled
    Stay:
      type: object
      properties:
        id:
          type: integer
        room:
          type: object
          properties:
            id:
              type: integer
            roomNumber:
              type: string
            status:
              $ref: '#/components/schemas/RoomStatus'
        mainGuestName:
          type: string
        extraGuestNames:
          type: array
          items:
            type: string
          nullable: true
        checkIn:
          type: string
          format: date
        checkOut:
          type: string
          format: date
        balance:
          oneOf:
            - type: number
            - type: string
        status:
          $ref: '#/components/schemas/StayStatus'
        createdBy:
          type: string
          nullable: true
        updatedBy:
          type: string
          nullable: true
        updatedByRole:
          type: string
          nullable: true
          enum:
            - guest
            - admin
            - editor
    CreateStayForRoomRequest:
      type: object
      required:
        - mainGuestName
        - checkIn
        - checkOut
      properties:
        mainGuestName:
          type: string
        extraGuestNames:
          type: array
          items:
            type: string
        checkIn:
          type: string
          format: date
          example: '2025-09-10'
        checkOut:
          type: string
          format: date
          example: '2025-09-14'
        balance:
          oneOf:
            - type: number
            - type: string
        status:
          $ref: '#/components/schemas/StayStatus'
          description: При створенні дозволено тільки booked|occupied
    UpdateStayByDatesRequest:
      type: object
      properties:
        mainGuestName:
          type: string
        extraGuestNames:
          type: array
          items:
            type: string
        newCheckIn:
          type: string
          format: date
        newCheckOut:
          type: string
          format: date
        balance:
          oneOf:
            - type: number
            - type: string
    CloseStayRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - completed
            - cancelled
    BulkPolicyHoursRequest:
      type: object
      description: Передай хоча б одне поле; null означає «слідувати дефолтам готелю».
      properties:
        checkInHour:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
        checkOutHour:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
    BulkWiFiRequest:
      type: object
      required:
        - wifiName
        - wifiPassword
      description: Масове оновлення Wi-Fi даних для всіх кімнат готелю.
      properties:
        wifiName:
          type: string
          maxLength: 100
          description: Назва Wi-Fi мережі (SSID)
          example: HotelGuest
        wifiPassword:
          type: string
          maxLength: 100
          description: Пароль Wi-Fi мережі
          example: SecurePassword123
paths:
  /auth/login:
    post:
      tags:
        - Auth
      summary: Логін (admin | editor)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              admin:
                value:
                  username: hotel-aurora
                  password: S3cure!Pass
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/create-admin:
    post:
      security:
        - bearerAuth: []
      tags:
        - Auth
      summary: Створити admin (superadmin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAdminRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateAdminResponse'
        '400':
          description: Validation/duplicate error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  '/auth/admin/{username}':
    put:
      security:
        - bearerAuth: []
      tags:
        - Auth
      summary: Оновити дані готелю (admin) — супер-адмін
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateHotelAdminRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateHotelAdminResponse'
        '403':
          description: Forbidden
        '404':
          description: Not found
  /auth/create-editor:
    post:
      security:
        - bearerAuth: []
      tags:
        - Auth
      summary: Створити editor (admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEditorRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateEditorResponse'
        '400':
          description: Validation/duplicate error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/users:
    get:
      security:
        - bearerAuth: []
      tags:
        - Auth
      summary: Список користувачів
      responses:
        '200':
          description: OK
        '403':
          description: Forbidden
  '/auth/block/{username}':
    put:
      security:
        - bearerAuth: []
      tags:
        - Auth
      summary: Заблокувати admin та всіх його editors (superadmin)
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleMessage'
        '404':
          description: Not found
  '/auth/unblock/{username}':
    put:
      security:
        - bearerAuth: []
      tags:
        - Auth
      summary: Розблокувати admin та всіх його editors (superadmin)
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleMessage'
        '404':
          description: Not found
  '/auth/delete/{username}':
    delete:
      security:
        - bearerAuth: []
      tags:
        - Auth
      summary: Видалити користувача (superadmin — будь-кого; admin — тільки своїх editor'ів)
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleMessage'
        '403':
          description: Forbidden
        '404':
          description: Not found
  /rooms/all:
    get:
      security:
        - bearerAuth: []
      tags:
        - Rooms
      summary: Усі кімнати по системі (superadmin)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Room'
  /rooms:
    get:
      security:
        - bearerAuth: []
      tags:
        - Rooms
      summary: Список кімнат поточного готелю
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Room'
    post:
      security:
        - bearerAuth: []
      tags:
        - Rooms
      summary: Створити кімнату
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRoomRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomResponse'
        '400':
          description: Validation error
        '409':
          description: Duplicate room
  '/rooms/status/{status}':
    get:
      security:
        - bearerAuth: []
      tags:
        - Rooms
      summary: Кімнати за статусом (free|booked|occupied)
      parameters:
        - name: status
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/RoomStatus'
      responses:
        '200':
          description: OK
  '/rooms/number/{roomNumber}':
    put:
      security:
        - bearerAuth: []
      tags:
        - Rooms
      summary: Повне редагування кімнати за roomNumber
      parameters:
        - name: roomNumber
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRoomRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomResponse'
        '404':
          description: Not found
        '409':
          description: Duplicate room number
    delete:
      security:
        - bearerAuth: []
      tags:
        - Rooms
      summary: Видалити кімнату
      parameters:
        - name: roomNumber
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleMessage'
        '404':
          description: Not found
  '/rooms/number/{roomNumber}/status':
    put:
      security:
        - bearerAuth: []
      tags:
        - Rooms
      summary: Ручна зміна статусу кімнати
      parameters:
        - name: roomNumber
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomStatusUpdateRequest'
      responses:
        '200':
          description: Updated
  '/rooms/{id}/cleaned':
    patch:
      security:
        - bearerAuth: []
      tags:
        - Rooms
      summary: Позначити кімнату як прибрану (cleaning → free)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
                  nullable: true
                  description: Коментар/нотатка про прибирання
      responses:
        '200':
          description: Room cleaned
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  room:
                    $ref: '#/components/schemas/Room'
        '400':
          description: Room is not in cleaning state
        '404':
          description: Room not found
  '/rooms/number/{roomNumber}/history':
    get:
      security:
        - bearerAuth: []
      tags:
        - Rooms
      summary: Історія змін статусів кімнати
      parameters:
        - name: roomNumber
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  roomNumber:
                    type: string
                  logs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        oldStatus:
                          type: string
                        newStatus:
                          type: string
                        changedAt:
                          type: string
                          format: date-time
                        changedBy:
                          type: string
                          nullable: true
                        changedByRole:
                          type: string
                          nullable: true
                          enum:
                            - system
                            - admin
                            - editor
                        stay:
                          nullable: true
                          type: object
                          properties:
                            id:
                              type: integer
                            mainGuestName:
                              type: string
                        entityLabel:
                          type: string
                          nullable: true
                        entityLink:
                          type: string
                          nullable: true
        '404':
          description: Room not found
  /rooms/policy-hours/bulk:
    put:
      security:
        - bearerAuth: []
      tags:
        - Policy Hours
      summary: Масово задати checkInHour/checkOutHour для всіх кімнат готелю
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkPolicyHoursRequest'
            examples:
              followHotelDefaults:
                value:
                  checkInHour: null
                  checkOutHour: null
              setCustomHours:
                value:
                  checkInHour: 15
                  checkOutHour: 11
      responses:
        '200':
          description: OK
  /rooms/wifi/bulk:
    put:
      security:
        - bearerAuth: []
      tags:
        - Wi-Fi Management
      summary: Масово оновити Wi-Fi дані (логін та пароль) для всіх кімнат готелю
      description: |
        Оновлює wifiName та wifiPassword для всіх кімнат готелю.
        Доступно тільки для адміністратора та редактора.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkWiFiRequest'
            examples:
              updateWiFi:
                value:
                  wifiName: HotelGuest
                  wifiPassword: SecurePassword123
      responses:
        '200':
          description: Wi-Fi дані успішно оновлені
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Wi-Fi credentials updated successfully
                  updated:
                    type: number
                    example: 25
                  applied:
                    type: object
                    properties:
                      wifiName:
                        type: string
                        example: HotelGuest
                      wifiPassword:
                        type: string
                        example: '***'
        '400':
          description: Невалідні дані
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Both wifiName and wifiPassword are required and must be non-empty strings
        '403':
          description: Доступ заборонено
  /rooms/availability:
    get:
      security:
        - bearerAuth: []
      tags:
        - Availability & Stats
      summary: Доступність усіх кімнат у діапазоні
      parameters:
        - name: from
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: to
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: details
          in: query
          required: false
          schema:
            type: string
            enum:
              - '1'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AvailabilityItem'
        '400':
          description: Missing from/to
  '/rooms/number/{roomNumber}/availability':
    get:
      security:
        - bearerAuth: []
      tags:
        - Availability & Stats
      summary: Доступність однієї кімнати
      parameters:
        - name: roomNumber
          in: path
          required: true
          schema:
            type: string
        - name: from
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: to
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: details
          in: query
          required: false
          schema:
            type: string
            enum:
              - '1'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AvailabilityItem'
        '404':
          description: Room not found
  /rooms/stats:
    get:
      security:
        - bearerAuth: []
      tags:
        - Availability & Stats
      summary: Кількість кімнат за статусами (free/booked/occupied/cleaning)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomsStats'
  /rooms/stays/current:
    get:
      security:
        - bearerAuth: []
      tags:
        - Availability & Stats
      summary: Усі активні проживання (booked/occupied)
      responses:
        '200':
          description: OK
  '/rooms/number/{roomNumber}/stays':
    get:
      security:
        - bearerAuth: []
      tags:
        - Stays
      summary: Історія проживань по кімнаті (опційно з фільтром дат)
      parameters:
        - name: roomNumber
          in: path
          required: true
          schema:
            type: string
        - name: from
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Stay'
    post:
      security:
        - bearerAuth: []
      tags:
        - Stays
      summary: Створити бронювання/заселення
      parameters:
        - name: roomNumber
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateStayForRoomRequest'
            examples:
              create:
                value:
                  mainGuestName: Mario Rossi
                  checkIn: '2025-09-10'
                  checkOut: '2025-09-14'
                  status: booked
      responses:
        '201':
          description: Created
        '409':
          description: Conflicting dates
    put:
      security:
        - bearerAuth: []
      tags:
        - Stays
      summary: Оновити проживання за датами (checkIn/checkOut)
      parameters:
        - name: roomNumber
          in: path
          required: true
          schema:
            type: string
        - name: checkIn
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: checkOut
          in: query
          required: true
          schema:
            type: string
            format: date
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateStayByDatesRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  stay:
                    $ref: '#/components/schemas/Stay'
        '404':
          description: Stay not found
        '409':
          description: Conflicting dates
  '/rooms/number/{roomNumber}/stays/close':
    put:
      security:
        - bearerAuth: []
      tags:
        - Stays
      summary: Закрити проживання (completed|cancelled) за ключем дат
      parameters:
        - name: roomNumber
          in: path
          required: true
          schema:
            type: string
        - name: checkIn
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: checkOut
          in: query
          required: true
          schema:
            type: string
            format: date
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CloseStayRequest'
      responses:
        '200':
          description: Closed
  '/stays/{id}/checkin':
    patch:
      security:
        - bearerAuth: []
      tags:
        - Stay Ops
      summary: Ручний check-in (booked → occupied або walk-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: string
                  nullable: true
                  description: Коментар до логу (необов'язковий)
      responses:
        '200':
          description: OK
        '400':
          description: Room not available for check-in
  '/stays/{id}/checkout':
    patch:
      security:
        - bearerAuth: []
      tags:
        - Stay Ops
      summary: Ручний check-out (occupied → completed → cleaning)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: string
                  nullable: true
                  description: Коментар до логу (необов'язковий)
      responses:
        '200':
          description: OK
        '400':
          description: Stay must be occupied before check-out
  '/stays/{id}/cancel':
    patch:
      security:
        - bearerAuth: []
      tags:
        - Stay Ops
      summary: Скасувати бронювання (booked → cancelled)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: string
                  nullable: true
                  description: Коментар причини скасування
      responses:
        '200':
          description: OK
        '400':
          description: Only booked stay can be cancelled
  '/stays/{id}/status':
    put:
      security:
        - bearerAuth: []
      tags:
        - Stay Ops
      summary: Оновити статус проживання (з автоматичною синхронізацією кімнати)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  $ref: '#/components/schemas/StayStatus'
                comment:
                  type: string
                  nullable: true
                  description: Обов'язковий при статусі cancelled для адміністраторів/редакторів
      responses:
        '200':
          description: OK
  '/stays/status/{status}':
    get:
      security:
        - bearerAuth: []
      tags:
        - Stay Queries
      summary: Список проживань за статусом
      parameters:
        - name: status
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/StayStatus'
      responses:
        '200':
          description: OK
  /stays/today/arrivals:
    get:
      security:
        - bearerAuth: []
      tags:
        - Stay Queries
      summary: Сьогоднішні заїзди (checkIn = today) — booked/occupied
      responses:
        '200':
          description: OK
  /stays/today/departures:
    get:
      security:
        - bearerAuth: []
      tags:
        - Stay Queries
      summary: Сьогоднішні виїзди (checkOut = today) — occupied
      responses:
        '200':
          description: OK
  /stays/search:
    get:
      security:
        - bearerAuth: []
      tags:
        - Stay Queries
      summary: Пошук проживань по гостю або користувачу
      parameters:
        - name: guest
          in: query
          required: false
          schema:
            type: string
          description: Фільтр по імені гостя (часткове співпадіння)
        - name: changedBy
          in: query
          required: false
          schema:
            type: string
          description: 'Фільтр по користувачу, який змінював (часткове співпадіння)'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Stay'
  '/stays/{id}':
    get:
      security:
        - bearerAuth: []
      tags:
        - Stay Queries
      summary: Отримати проживання за ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID проживання
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Stay'
        '404':
          description: Stay not found
  '/stays/{id}/history':
    get:
      security:
        - bearerAuth: []
      tags:
        - Stay Queries
      summary: Історія змін статусів проживання
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID проживання
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  stayId:
                    type: integer
                  mainGuestName:
                    type: string
                  logs:
                    type: array
                    items:
                      type: object
                      properties:
                        oldStatus:
                          type: string
                        newStatus:
                          type: string
                        changedAt:
                          type: string
                          format: date-time
                        changedBy:
                          type: string
                          nullable: true
                        changedByRole:
                          type: string
                          nullable: true
                        comment:
                          type: string
                          nullable: true
        '404':
          description: Stay not found
  /audit/logs:
    get:
      security:
        - bearerAuth: []
      tags:
        - Audit
      summary: Отримати audit logs (об'єднані RoomStatusLog та StayStatusLog)
      description: |
        Повертає об'єднану історію змін з RoomStatusLog та StayStatusLog з можливістю фільтрації.
        Логи автоматично фільтруються по готелю поточного користувача.
      parameters:
        - name: type
          in: query
          required: false
          schema:
            type: string
            enum:
              - room
              - stay
          description: 'Фільтр по типу логів (room - тільки кімнати, stay - тільки проживання, якщо не вказано - обидва)'
        - name: user
          in: query
          required: false
          schema:
            type: string
          description: Фільтр по імені користувача (changedBy) - часткове співпадіння
        - name: role
          in: query
          required: false
          schema:
            type: string
            enum:
              - guest
              - admin
              - editor
              - system
          description: Фільтр по ролі користувача (changedByRole) - точне співпадіння
        - name: from
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Дата початку діапазону (ISO 8601)
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Дата кінця діапазону (ISO 8601)
      responses:
        '200':
          description: Масив audit logs
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      enum:
                        - room
                        - stay
                      description: Тип логу
                    entityLabel:
                      type: string
                      description: 'Назва сутності (наприклад, "Room 102" або "John Doe")'
                    entityLink:
                      type: string
                      nullable: true
                      description: 'Посилання на сутність (наприклад, "/rooms/102/stays" або "/stays/77")'
                    oldStatus:
                      type: string
                      description: Попередній статус
                    newStatus:
                      type: string
                      description: Новий статус
                    changedAt:
                      type: string
                      format: date-time
                      description: Дата та час зміни
                    changedBy:
                      type: string
                      nullable: true
                      description: 'Ім''я користувача, який зробив зміну'
                    changedByRole:
                      type: string
                      nullable: true
                      enum:
                        - guest
                        - admin
                        - editor
                        - system
                      description: Роль користувача
                    comment:
                      type: string
                      nullable: true
                      description: Коментар до зміни статусу (якщо вказано)
              example:
                - type: room
                  entityLabel: Room 102
                  entityLink: /rooms/102/stays
                  oldStatus: booked
                  newStatus: occupied
                  changedAt: '2025-08-21T14:10:00Z'
                  changedBy: frontdesk-1
                  changedByRole: editor
                - type: stay
                  entityLabel: John Doe
                  entityLink: /stays/77
                  oldStatus: booked
                  newStatus: cancelled
                  changedAt: '2025-08-22T10:45:00Z'
                  changedBy: guest
                  changedByRole: guest
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
