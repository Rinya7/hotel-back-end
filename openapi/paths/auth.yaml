# openapi/paths/auth.yaml
auth_login:
  post:
    tags: [Auth]
    summary: Логін (admin | editor)
    requestBody:
      required: true
      content:
        application/json:
          schema:
            { $ref: "../openapi.base.yaml#/components/schemas/LoginRequest" }
          examples:
            admin:
              value: { username: "hotel-aurora", password: "S3cure!Pass" }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/LoginResponse" }
      "401":
        description: Invalid credentials
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/ErrorResponse" }

auth_create_admin:
  post:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Створити admin (superadmin only)
    requestBody:
      required: true
      content:
        application/json:
          schema:
            {
              $ref: "../openapi.base.yaml#/components/schemas/CreateAdminRequest",
            }
    responses:
      "201":
        description: Created
        content:
          application/json:
            schema:
              {
                $ref: "../openapi.base.yaml#/components/schemas/CreateAdminResponse",
              }
      "400":
        description: Validation/duplicate error
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/ErrorResponse" }
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/ErrorResponse" }

auth_update_admin:
  put:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Оновити дані готелю (admin) — супер-адмін
    parameters:
      - name: username
        in: path
        required: true
        schema: { type: string }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            {
              $ref: "../openapi.base.yaml#/components/schemas/UpdateHotelAdminRequest",
            }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              {
                $ref: "../openapi.base.yaml#/components/schemas/UpdateHotelAdminResponse",
              }
      "403": { description: Forbidden }
      "404": { description: Not found }

auth_create_editor:
  post:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Створити editor (admin only)
    requestBody:
      required: true
      content:
        application/json:
          schema:
            {
              $ref: "../openapi.base.yaml#/components/schemas/CreateEditorRequest",
            }
    responses:
      "201":
        description: Created
        content:
          application/json:
            schema:
              {
                $ref: "../openapi.base.yaml#/components/schemas/CreateEditorResponse",
              }
      "400":
        description: Validation/duplicate error
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/ErrorResponse" }
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/ErrorResponse" }

auth_users:
  get:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Список користувачів
    responses:
      "200":
        description: OK
      "403":
        description: Forbidden

auth_profile:
  get:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Получить информацию о текущем админе (профиль + редакторы)
    description: >
      Для админа возвращает полную информацию об админе и его редакторах.
      Для суперадмина возвращает список всех админов с редакторами.
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              oneOf:
                - { $ref: "../openapi.base.yaml#/components/schemas/PublicAdminUser" }
                - type: array
                  items:
                    { $ref: "../openapi.base.yaml#/components/schemas/PublicAdminUser" }
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/ErrorResponse" }
      "404":
        description: Not found
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/ErrorResponse" }
      "500":
        description: Internal server error
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/ErrorResponse" }

auth_block:
  put:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Заблокувати admin та всіх його editors (superadmin)
    parameters:
      - name: username
        in: path
        required: true
        schema: { type: string }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/SimpleMessage" }
      "404":
        description: Not found

auth_unblock:
  put:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Розблокувати admin та всіх його editors (superadmin)
    parameters:
      - name: username
        in: path
        required: true
        schema: { type: string }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/SimpleMessage" }
      "404":
        description: Not found

auth_block_editor:
  put:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Заблокувати редактора (admin only, тільки своїх редакторів)
    parameters:
      - name: username
        in: path
        required: true
        schema: { type: string }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/SimpleMessage" }
      "403":
        description: Forbidden
      "404":
        description: Not found

auth_unblock_editor:
  put:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Розблокувати редактора (admin only, тільки своїх редакторів)
    parameters:
      - name: username
        in: path
        required: true
        schema: { type: string }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/SimpleMessage" }
      "403":
        description: Forbidden
      "404":
        description: Not found

auth_update_editor:
  put:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Оновити дані редактора (admin only, тільки своїх редакторів)
    description: >
      Адмін може редагувати тільки своїх редакторів.
      Не можна змінювати: username, password, role.
    parameters:
      - name: username
        in: path
        required: true
        schema: { type: string }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              full_name:
                type: string
                nullable: true
              email:
                type: string
                nullable: true
              phoneCountryCode:
                type: string
                nullable: true
              phoneNumber:
                type: string
                nullable: true
              phone:
                type: string
                nullable: true
                description: Для обратной совместимости
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                editor:
                  type: object
                  properties:
                    id:
                      type: integer
                    username:
                      type: string
                    role:
                      type: string
                    full_name:
                      type: string
                      nullable: true
                    phoneCountryCode:
                      type: string
                      nullable: true
                    phoneNumber:
                      type: string
                      nullable: true
                    phone:
                      type: string
                      nullable: true
                    email:
                      type: string
                      nullable: true
                    isBlocked:
                      type: boolean
                    createdAt:
                      type: string
                      format: date-time
                    updatedAt:
                      type: string
                      format: date-time
      "403":
        description: Forbidden
      "404":
        description: Not found

auth_delete:
  delete:
    security: [{ bearerAuth: [] }]
    tags: [Auth]
    summary: Видалити користувача (superadmin — будь-кого; admin — тільки своїх editor'ів)
    parameters:
      - name: username
        in: path
        required: true
        schema: { type: string }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              { $ref: "../openapi.base.yaml#/components/schemas/SimpleMessage" }
      "403":
        description: Forbidden
      "404":
        description: Not found
