# openapi/paths/audit.yaml
# Універсальний endpoint для audit logs

audit_logs:
  get:
    security:
      - bearerAuth: []
    tags:
      - Audit
    summary: Отримати audit logs (об'єднані RoomStatusLog та StayStatusLog)
    description: |
      Повертає об'єднану історію змін з RoomStatusLog та StayStatusLog з можливістю фільтрації.
      Логи автоматично фільтруються по готелю поточного користувача.
    parameters:
      - name: type
        in: query
        required: false
        schema:
          type: string
          enum: [room, stay]
        description: Фільтр по типу логів (room - тільки кімнати, stay - тільки проживання, якщо не вказано - обидва)
      - name: user
        in: query
        required: false
        schema:
          type: string
        description: Фільтр по імені користувача (changedBy) - часткове співпадіння
      - name: role
        in: query
        required: false
        schema:
          type: string
          enum: [guest, admin, editor, system]
        description: Фільтр по ролі користувача (changedByRole) - точне співпадіння
      - name: from
        in: query
        required: false
        schema:
          type: string
          format: date-time
        description: Дата початку діапазону (ISO 8601)
      - name: to
        in: query
        required: false
        schema:
          type: string
          format: date-time
        description: Дата кінця діапазону (ISO 8601)
      - name: roomNumber
        in: query
        required: false
        schema:
          type: string
        description: Фільтр по номеру кімнати (тільки для room logs, частковий пошук)
      - name: stayId
        in: query
        required: false
        schema:
          type: integer
        description: Фільтр по ідентифікатору проживання (тільки для stay logs)
      - name: bookingCode
        in: query
        required: false
        schema:
          type: string
        description: Фільтр по номеру бронювання (формат "roomNumber-stayId")
    responses:
      "200":
        description: Масив audit logs
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                    enum: [room, stay]
                    description: Тип логу
                  entityLabel:
                    type: string
                    description: Значення пов'язаної сутності (номер кімнати або ID проживання)
                  entityLink:
                    type: string
                    nullable: true
                    description: Посилання на сутність (наприклад, "/rooms/102/stays" або "/stays/77")
                  oldStatus:
                    type: string
                    description: Попередній статус
                  newStatus:
                    type: string
                    description: Новий статус
                  changedAt:
                    type: string
                    format: date-time
                    description: Дата та час зміни
                  changedBy:
                    type: string
                    nullable: true
                    description: Ім'я користувача, який зробив зміну
                  changedByRole:
                    type: string
                    nullable: true
                    enum: [guest, admin, editor, system]
                    description: Роль користувача
                  comment:
                    type: string
                    nullable: true
                    description: Коментар до зміни статусу (якщо вказано)
                  roomNumber:
                    type: string
                    nullable: true
                    description: Номер кімнати, до якої належить запис (якщо застосовно)
                  stayId:
                    type: integer
                    nullable: true
                    description: Ідентифікатор проживання (якщо застосовно)
                  bookingCode:
                    type: string
                    nullable: true
                    description: Складений номер бронювання (номер кімнати + ID проживання)
                  stayCheckIn:
                    type: string
                    format: date
                    nullable: true
                    description: Дата початку проживання (якщо лог пов'язаний із stay)
                  stayCheckOut:
                    type: string
                    format: date
                    nullable: true
                    description: Дата завершення проживання (якщо лог пов'язаний із stay)
            example:
              - type: room
                entityLabel: "102"
                entityLink: "/rooms/102/stays"
                oldStatus: "free"
                newStatus: "occupied"
                changedAt: "2025-08-21T14:10:00Z"
                changedBy: "frontdesk-1"
                changedByRole: "editor"
                roomNumber: "102"
                stayId: 77
                bookingCode: "102-77"
                stayCheckIn: "2025-08-21"
                stayCheckOut: "2025-08-24"
              - type: stay
                entityLabel: "77"
                entityLink: "/rooms/102/stays"
                oldStatus: "booked"
                newStatus: "cancelled"
                changedAt: "2025-08-22T10:45:00Z"
                changedBy: "guest"
                changedByRole: "guest"
                roomNumber: "102"
                stayId: 77
                bookingCode: "102-77"
                stayCheckIn: "2025-08-21"
                stayCheckOut: "2025-08-24"
      "401":
        description: Unauthorized
      "403":
        description: Forbidden

