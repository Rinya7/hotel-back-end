# Migrations (–ú—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö)

## –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–∞–ø–∫–∏

–ü–∞–ø–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –º—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö - SQL —Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –∑–º—ñ–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞–±–ª–∏—Ü—å. 

**‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û:** –í—Å—ñ —Å—Ç–∞—Ä—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó –±—É–ª–∏ –∫–æ–Ω—Å–æ–ª—ñ–¥–æ–≤–∞–Ω—ñ –≤ –æ–¥–Ω—É —Ñ—ñ–Ω–∞–ª—å–Ω—É –º—ñ–≥—Ä–∞—Ü—ñ—é –¥–ª—è —á–∏—Å—Ç–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

## –ü–æ—Ç–æ—á–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/migrations/
‚îú‚îÄ‚îÄ 1700000000000-init_schema.ts    # ‚úÖ –§–Ü–ù–ê–õ–¨–ù–ê –º—ñ–≥—Ä–∞—Ü—ñ—è - —Å—Ç–≤–æ—Ä—é—î –≤—Å—é —Å—Ö–µ–º—É –ë–î
‚îú‚îÄ‚îÄ old/                             # üì¶ –°—Ç–∞—Ä—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –¥–æ–≤—ñ–¥–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ [20 —Å—Ç–∞—Ä–∏—Ö –º—ñ–≥—Ä–∞—Ü—ñ–π]
‚îú‚îÄ‚îÄ README.md                        # –®–≤–∏–¥–∫–∞ –¥–æ–≤—ñ–¥–∫–∞ (–∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é)
‚îú‚îÄ‚îÄ MIGRATION_CLEANUP.md             # –î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îî‚îÄ‚îÄ INFO.md                          # –¶–µ–π —Ñ–∞–π–ª
```

## –§—ñ–Ω–∞–ª—å–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è

### `1700000000000-init_schema.ts`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –Ñ–¥–∏–Ω–∞ –∫–æ–Ω—Å–æ–ª—ñ–¥–æ–≤–∞–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è, —è–∫–∞ —Å—Ç–≤–æ—Ä—é—î –ø–æ–≤–Ω—É —Å—Ö–µ–º—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∑ –Ω—É–ª—è.

**–©–æ —Å—Ç–≤–æ—Ä—é—î:**

#### ENUM —Ç–∏–ø–∏:
- `admin_role_enum`: `'superadmin' | 'admin' | 'editor'`
- `room_status_enum`: `'free' | 'occupied' | 'cleaning'`
- `stay_status_enum`: `'booked' | 'occupied' | 'completed' | 'cancelled'`

#### –¢–∞–±–ª–∏—Ü—ñ:
1. **`admin`** - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Å–∏—Å—Ç–µ–º–∏ (superadmin, admin, editor)
2. **`room`** - –∫—ñ–º–Ω–∞—Ç–∏ –≥–æ—Ç–µ–ª—ñ–≤
3. **`stay`** - –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è/–ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è
4. **`stay_guest`** - –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≥–æ—Å—Ç–µ–π
5. **`guest_access_token`** - —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É –≥–æ—Å—Ç–µ–π
6. **`stay_status_log`** - —ñ—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—ñ–≤ –±—Ä–æ–Ω—é–≤–∞–Ω—å
7. **`room_status_log`** - —ñ—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—ñ–≤ –∫—ñ–º–Ω–∞—Ç
8. **`room_cleaning_log`** - —ñ—Å—Ç–æ—Ä—ñ—è –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –∫—ñ–º–Ω–∞—Ç

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
- ‚úÖ –í—Å—ñ foreign keys –∑ CASCADE/SET NULL
- ‚úÖ Unique constraints (–Ω–æ–º–µ—Ä–∏ –∫—ñ–º–Ω–∞—Ç —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –≤ –º–µ–∂–∞—Ö –æ—Ç–µ–ª—è)
- ‚úÖ Check constraints (policy hours: 0-23)
- ‚úÖ Timestamps (createdAt/updatedAt)
- ‚úÖ –ê—É–¥–∏—Ç –ø–æ–ª—è (createdBy, updatedBy, updatedByRole)

## –ó–≤'—è–∑–∫–∏ –º—ñ–∂ —Ç–∞–±–ª–∏—Ü—è–º–∏

- `admin` ‚Üí `room` (1:N, CASCADE) - –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∞–¥–º—ñ–Ω–∞ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –≤—Å—ñ –π–æ–≥–æ –∫—ñ–º–Ω–∞—Ç–∏
- `room` ‚Üí `stay` (1:N, CASCADE) - –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∫—ñ–º–Ω–∞—Ç–∏ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –≤—Å—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
- `stay` ‚Üí `stay_guest` (1:N, CASCADE) - –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –≥–æ—Å—Ç—ñ
- `stay` ‚Üí `guest_access_token` (1:N, CASCADE) - —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É
- `stay` ‚Üí `stay_status_log` (1:N, CASCADE) - –ª–æ–≥–∏ –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—ñ–≤
- `room` ‚Üí `room_status_log` (1:N, CASCADE) - –ª–æ–≥–∏ –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—ñ–≤ –∫—ñ–º–Ω–∞—Ç
- `room` ‚Üí `room_cleaning_log` (1:N, CASCADE) - –ª–æ–≥–∏ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è
- `stay` ‚Üí `room_status_log` (1:N, SET NULL) - –∑–≤'—è–∑–æ–∫ –∑—ñ stay –º–æ–∂–µ –±—É—Ç–∏ null

## –°—Ç–∞—Ä—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó

–í—Å—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó (20 —Ñ–∞–π–ª—ñ–≤) –ø–µ—Ä–µ–º—ñ—â–µ–Ω—ñ –≤ –ø–∞–ø–∫—É `/old/` –¥–ª—è –¥–æ–≤—ñ–¥–∫–∏.

**‚ö†Ô∏è –ù–ï –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å—Ç–∞—Ä—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó –Ω–∞ –Ω–æ–≤—ñ–π –±–∞–∑—ñ –¥–∞–Ω–∏—Ö!**

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ `1700000000000-init_schema.ts` –¥–ª—è –Ω–æ–≤–∏—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫.

## –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –º—ñ–≥—Ä–∞—Ü—ñ—è–º–∏

### –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é (–Ω–æ–≤–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö)

```bash
npm run db:migrate
```

–¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –≤—Å—é —Å—Ö–µ–º—É –ë–î –∑ –Ω—É–ª—è.

### –í—ñ–¥–∫–∞—Ç–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é

```bash
npm run db:revert
```

**‚ö†Ô∏è –£–≤–∞–≥–∞:** –í—ñ–¥–∫–∞—Ç –≤–∏–¥–∞–ª–∏—Ç—å –≤—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ —Ç–∞ –¥–∞–Ω—ñ!

### –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –Ω–æ–≤—É –º—ñ–≥—Ä–∞—Ü—ñ—é (–¥–ª—è –º–∞–π–±—É—Ç–Ω—ñ—Ö –∑–º—ñ–Ω)

```bash
npm run db:gen:init
```

**–í–∞–∂–ª–∏–≤–æ:** 
1. –°–ø–æ—á–∞—Ç–∫—É –∑–º—ñ–Ω–∏—Ç–∏ entities (–¥–æ–¥–∞—Ç–∏/–∑–º—ñ–Ω–∏—Ç–∏ –ø–æ–ª—è)
2. –ü–æ—Ç—ñ–º –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–¥
4. –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é

## –í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏

- **–î–ª—è –Ω–æ–≤–æ—ó –ë–î** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ `1700000000000-init_schema.ts`
- **–î–ª—è —ñ—Å–Ω—É—é—á–æ—ó –ë–î** - —Å—Ç–≤–æ—Ä—é–π—Ç–µ –Ω–æ–≤—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó –¥–ª—è —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω
- **Backup –ø–µ—Ä–µ–¥ –º—ñ–≥—Ä–∞—Ü—ñ—î—é** - –≤ production –∑–∞–≤–∂–¥–∏ —Ä–æ–±–∏—Ç–∏ backup
- **–ê—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å** - –∫–æ–∂–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è –º–∞—î –±—É—Ç–∏ –∞—Ç–æ–º–∞—Ä–Ω–æ—é (–∞–±–æ –≤—Å–µ, –∞–±–æ –Ω—ñ—á–æ–≥–æ)
- **–¢–µ—Å—Ç—É–≤–∞—Ç–∏ down()** - –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤—ñ–¥–∫–∞—Ç –ø—Ä–∞—Ü—é—î

## –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –º—ñ–≥—Ä–∞—Ü—ñ—ó (–¥–ª—è –º–∞–π–±—É—Ç–Ω—ñ—Ö –∑–º—ñ–Ω)

1. –ó–º—ñ–Ω–∏—Ç–∏ entities (–¥–æ–¥–∞—Ç–∏/–∑–º—ñ–Ω–∏—Ç–∏ –ø–æ–ª—è)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ `npm run db:gen:init` - –∑–≥–µ–Ω–µ—Ä—É—î –º—ñ–≥—Ä–∞—Ü—ñ—é
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–¥
4. –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ `npm run db:migrate`
5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- **README.md** - —à–≤–∏–¥–∫–∞ –¥–æ–≤—ñ–¥–∫–∞ (–∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é)
- **MIGRATION_CLEANUP.md** - –¥–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—é –º—ñ–≥—Ä–∞—Ü—ñ–π

---

**–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** 2025-01-23




